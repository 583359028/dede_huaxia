<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>华夏夫人-{dede:field.typename/}</title>
  <meta name="Keywords" content="">
  <meta name="Description" content="">
   <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <link rel="stylesheet" type="text/css" href="{dede:global.cfg_templets_skin/}/css/mobile.css">
	<link rel="stylesheet" type="text/css" href="{dede:global.cfg_templets_skin/}/css/reset.css">
	<link rel="stylesheet" type="text/css" href="{dede:global.cfg_templets_skin/}/css/style.css">
  <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
    <script  src='/layer/jquery.js' ></script>
    <script  src='/layer/mobile/layer.js' ></script>
</head>
<body>

<!--内页头部部分-->
{dede:include filename="inhead.htm"/}
<!--top is over-->
<section class="peixun_content">
<span class="position">当前位置：{dede:field name='position'/}</span>
 <div class="peixun_photo">
    <div class="photo_box"><img src="{dede:global.cfg_templets_skin/}/img/peixun1.png" alt="华夏夫人1"></div>
    <div class="photo_box"><img src="{dede:global.cfg_templets_skin/}/img/peixun2.png" alt="华夏夫人2"></div>
    <div class="photo_box"><img src="{dede:global.cfg_templets_skin/}/img/peixun3.png" alt="华夏夫人3"></div>
    <div class="photo_box"><img src="{dede:global.cfg_templets_skin/}/img/peixun4.png" alt="华夏夫人4"></div>
    <div class="photo_box"><img src="{dede:global.cfg_templets_skin/}/img/peixun5.png" alt="华夏夫人5"></div>
    <div class="photo_box"><img src="{dede:global.cfg_templets_skin/}/img/peixun6.png" alt="华夏夫人6"></div>
 </div>
 <div class="kecheng">
  <div class="kecheng_left"><img src="{dede:global.cfg_templets_skin/}/img/peixun7.png" alt="笔墨"></div>
  <div class="kecheng_right">
     {dede:arclist row='3' addfields='aid,time,neir,feiy,price,phone,teacher' channelid='20' isweight='y' orderby='weight'}
     <div class="kecheng_box"><h3><span>[field:title/]</span></h3><p><span>时长：</span><span>[field:time/]</span></p>
     <p><span>内容：</span><span>[field:neir/]</span></p>
      <p><span>费用：</span><span>[field:feiy/]</span></p><span    onclick="pay('[field:title/]','[field:neir/]','[field:price/]','[field:aid/]','[field:time/]','[field:phone/]','[field:teacher/]')">参与培训</span></div>
      {/dede:arclist}
  </div>
 </div>
<section class="infoot">
  <!--pc新增滚动入口-->
{dede:include filename="gdrk.htm"/}
   </div>
</section>
<a href="/a/new" class="jzmore jzmore2 mcss">查看更多</a>
<div class="clear"></div>
 <div class="infoot_process">
<ul><li><span></span><em>选拔流程Process</em></li>
<li><span>1</span><em>免费报名</em></li>
<li><span>2</span><em>第一轮海选</em></li>
<li><span>3</span><em>第二轮市选</em></li>
<li><span>4</span><em>第三轮省选</em></li>
<li><span>5</span><em>第四轮国选</em></li>
<li><span>6</span><em>第五轮丝路巡</em></li></ul>
 </div>
</section>
</section>
<div class="hid_box" id="mcss" >
<div class='show_box'><span class='close' onclick='hideK()'></span><p>抱歉，您还没有登录，登录后才能报名哦~<br/>赶快去登录吧！</p>
<div class='show_btn'><a href='/member/login.php'>去登录</a><a href='/member/index_do.php?fmdo=user&dopost=regnew'>去注册</a></div></div></div>
<p class="bm_mbtn mcss" style="position: fixed;bottom:0;z-index: 99"><a href="{dede:type typeid='18'}[field:typeurl/]{/dede:type}" class="tou_box">夫人在线报名</a><a href="/member/index_do.php?fmdo=user&dopost=regnew">会员在线注册</a></p>
<style type="text/css">.bm_mbtn{overflow: hidden;width:640px;margin:40px auto;}
.bm_mbtn a{display: inline-block;*display: block;*zoom:1;text-shadow:4px 0 3px #000;color:rgba(255,255,255,0.75);margin-left: 60px;font-size: 30px;width:240px;height:72px;background: url(../img/btbg.png)0 0 no-repeat;background-size: cover;text-align:center;line-height: 72px}.show_box3 p a{padding:1%;}</style>
<script>
    function hideK(){
      $('.hid_box').css('display','none');
    }
  </script>
{dede:include filename="foot.htm"/}

<section class="hid_box3">
  <div class="show_box3" ><form   action="/alipay/pagepay/pagepay.php" method="post" target="_blank">
      <div id="body1" class="show" name="divcontent"  style="display:none;">
          <dl class="content">
              <dt>商户订单号
                  ：</dt>
              <dd>
                  <input type="text"  id="WIDout_trade_no" name="WIDout_trade_no" readOnly="true"/>
              </dd>
              <hr class="one_line">
              <dt>订单名称
                  ：</dt>
              <dd>
                  <input  type="text" id="WIDsubject" name="WIDsubject" readOnly="true"/>
              </dd>
              <hr class="one_line">
              <dt>付款金额
                  ：</dt>
              <dd>
                  <input  type="text" id="WIDtotal_amount" name="WIDtotal_amount" readOnly="true"/>
              </dd>
              <hr class="one_line">
              <dt>商品描述：</dt>
              <dd>
                  <input type="text" id="WIDbody" name="WIDbody" readOnly="true"/>
              </dd>

              </dd>

              <dt></dt>
              <input  type="hidden"  name="mid" id="uid" value='
         {dede:php}
         require_once(DEDEINC."/memberlogin.class.php");
         $member = new  MemberLogin();
         $memberID = $member->M_ID;
         echo $memberID;
         {/dede:php}' />
          </dl>
          <input type="hidden"   id="time" name="time" value=""/>
          <input type="hidden" id="teacher" name="teacher" value=""/>
          <input type="hidden" id="phone" name="phone" value=""/>
          <input  type="hidden"  name="aid" id="aid" value="" />
          </dl>
      </div>
      <div   id="wu">
  <h2>选择支付方式</h2>
  <p><a  id="weixin"><img src="{dede:global.cfg_templets_skin/}/img/weixin2.png"  onclick="weixin_1()" ><em>微信支付</em></a>
  <a  id="gift2" class="zfb"><img src="{dede:global.cfg_templets_skin/}/img/zfb2.png"  onclick="go_money_1()"><em>支付宝支付</em></a></p></div>
  <div  id="none" style="display:none;width: 24%;margin: 37px auto;"><img src="../../images/wx/wechat.jpg" style="width:100%"></div>
   <div class="show_btn3"><div class="goods_btn">

   </div><button style="border-radius: 15px;display: inline-block;font-size: 24px;color: #fff;padding: 10px;width: 130px;text-align: center;background-color: #dedede;border: 2px solid #dedede;display:none;" class="zf"  id="go_money" type="submit" >支付宝</button>
       <button style="border-radius: 15px;display: inline-block;font-size: 24px;color: #fff;padding: 10px;width: 130px;text-align: center;background-color: #dedede;border: 2px solid #dedede;display:none;" class="zf"  id="go_weixin" type="button" onclick="pay_wx()" >微信</button>
       <button style="border-radius: 15px;display: inline-block;font-size: 24px;color: #fff;padding: 10px;width: 130px;text-align: center;background-color: #dedede;border: 2px solid #dedede;" class="zf"  id="select" onclick="select_s()" type="button" >去支付</button>
       <a href="#" class="close3" onclick="over()"  id="over" style="margin-left: 20px">关闭</a></div>
  </div>
</section>
</form>
<script type="text/javascript">
$(function(){
  $("#weixin").click(function(){
 $("#weixin img").attr("src","/templets/default/img/weixin.png");
 $(".zfb img").attr("src","/templets/default/img/zfb2.png");
})
  $(".zfb").click(function(){
 $(".zfb img").attr("src","/templets/default/img/zfb.png");
  $("#weixin img").attr("src","/templets/default/img/weixin2.png");
})

  })


</script>
<script src="{dede:global.cfg_templets_skin/}/js/lk.js"></script>
 <script src="{dede:global.cfg_templets_skin/}/js/menu.js"></script>
<script   language="javascript">
    function pay(b,c,d,e,time,phone,teacher){

        w_title =  b; //标题
        neir = c;  //内容
        price = d;  //money
        lid  = e;  //标题表的唯一id
        time_out = time; //课程的时间
        w_phone = phone;   //电话
        w_teacher = teacher; //老师名称



        var uid = $.trim(document.getElementById("uid").value);

        if( uid==0 ){

            var logins = document.getElementById('mcss');

            logins.style.display = "block";


        }else{


            var vNow = new Date();
            var sNow = "";
            sNow += String(vNow.getFullYear());
            sNow += String(vNow.getMonth() + 1);
            sNow += String(vNow.getDate());
            sNow += String(vNow.getHours());
            sNow += String(vNow.getMinutes());
            sNow += String(vNow.getSeconds());
            sNow += String(vNow.getMilliseconds());
            document.getElementById("WIDout_trade_no").value =  sNow;
            document.getElementById("WIDsubject").value = b;
            //document.getElementById("WIDtotal_amount").value = d;
            document.getElementById("WIDtotal_amount").value = '0.01';
            document.getElementById("WIDbody").value='2';
            document.getElementById("aid").value = e;
            document.getElementById("time").value = time;
            document.getElementById("phone").value= phone;
            document.getElementById("teacher").value = teacher;
            $(".hid_box3").css("display","block");


        }

    }

    function  over(){

        $(".hid_box3").css("display","none");
         $(".return").css("display","none");

    }
    function go_money_1(){

        document.getElementById("go_money").style.display="inline-block";
        document.getElementById("go_weixin").style.display="none";
        document.getElementById("select").style.display="none";
    }

    function  zhifu(){
      document.getElementById("wu").style.display="none";
      document.getElementById("none").style.display="block";

    }

    function weixin_1(){

       document.getElementById("select").style.display="none";
       document.getElementById("go_weixin").style.display="inline-block";
       document.getElementById("go_money").style.display="none";

    }
function select_s(){

        alert('请选择支付方式');

/*
    $.ajax({
        type:'POST',
        url:"/ss.php",
        data:{user:1},
        dataType: "json",
        success:function (ss) {

            alert(ss.message);
            console.log(ss.message);
    }});
*/


}

function pay_wx(){

    //alert(w_title); //标题
    //alert(neir); //内容
    //alert(price); //money
    //alert(lid); //标题表的唯一id
  //  alert(time_out); //课程的时间
  //  alert(w_phone);//电话
  //  alert(w_teacher); //老师名称
     var type = document.getElementById("WIDbody").value; //消费方式
   // alert(type);
    $.ajax({
        type:'POST',
        url:'/payment/example/native.php',
        data:{
            w_title:w_title,
            w_amount:price,
            lid:lid,
            time_out:time_out,
            w_phone:w_phone,
            w_teacher:w_teacher,
            type:type},
        dataType:"json",
        success:function(code){
        var code_code = code.code;  //二维码集
        var wx_trade_no = code.out_trade_no;   //商户号

        if(code.message == 1){
       var  huixian  =  price;
            layer.open({
              //  type: 4,
                skin: 'layui-layer-rim', //样式类名，随意！
                closeBtn: 0, //不显示关闭按钮
                title:false, //关闭title部分
                anim: 2,
                area: ['300px', '450px'], //层的宽高
                shadeClose: true, //开启遮罩关闭
                content: '<div style="color: #666;margin: 5px 0 0 10px;position: absolute;right:.5rem;" onclick="layer.closeAll()">X</div>'+'<div style="text-align: center;"><img style="width: 4rem;padding:2rem 0 1rem 0;" src="/templets/default/img/weixin.png" alt="" /><br><b style="font-weight: 100;color: #888;">请打开微信 扫码进行支付 </b><div class="blank"></div>支付金额：<span style="color: red;">'+huixian+'</span> 元</div><div class="blank"></div>'+'<div style="text-align: center"><img src="'+"http://paysdk.weixin.qq.com/example/qrcode.php?data="+code_code+'" class="resize" style="width:70%;"></div><div id="myDiv" style="width: 100%;height: 1.5rem;bottom: 2rem;position:absolute;text-align:center;font-size: 1.2rem;color: red;"></div><div id="timer" style="display:none;">0</div>'
            });


            var  myIntval = setInterval(function(){load()},1000);//定义个方法 1000毫秒执行一次

            function load(){

                var xmlhttp;

                if(window.XMLHttpRequest){    //如果不是ie浏览器

                    xmlhttp =  new  XMLHttpRequest();

                }else if(window.ActiveXObject){   //如果是ie浏览器

                    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");

                }

//    readyState 属性表示Ajax请求的当前状态。它的值用数字代表。
//                0 代表未初始化。 还没有调用 open 方法
//    1 代表正在加载。 open 方法已被调用，但 send 方法还没有被调用
//    2 代表已加载完毕。send 已被调用。请求已经开始
//    3 代表交互中。服务器正在发送响应
//    4 代表完成。响应发送完毕

//    常用状态码及其含义：
//                404 没找到页面(not found)
//    403 禁止访问(forbidden)
//    500 内部服务器出错(internal service error)
//    200 一切正常(ok)
//    304 没有被修改(not modified)(服务器返回304状态，表示源文件没有被修改 )

                xmlhttp.onreadystatechange=function(){

                    if(xmlhttp.readyState==4 && xmlhttp.status==200){

                        trade_state=JSON.parse(xmlhttp.responseText);   //吧返回过来的json数据转换下
            // alert(trade_state.code);
                        if(trade_state.code=="NOTPAY"){

                      document.getElementById("myDiv").innerHTML="请扫码支付";

                        }else if(trade_state.code="SUCCESS"){

                            document.getElementById("myDiv").innerHTML="支付成功";
                            clearInterval(myIntval);
                            setTimeout("location.href='/plus/list.php?tid=4'",3000);

                        }else if(trade_state.code="CLOSED"){

                            document.getElementById("myDiv").innerHTML="交易已关闭";
                            clearInterval(myIntval);
                        }else if(trade_state.code="REVOKED"){

                            document.getElementById("myDiv").innerHTML="已撤销";
                             clearInterval(myIntval);

                        }else if(trade_state.code="REFUND"){

                            document.getElementById("myDiv").innerHTML="转入退款";
                             clearInterval(myIntval);

                        }else if(trade_state.code="USERPAYING"){

                            document.getElementById("myDiv").innerHTML="用户支付中";
                            clearInterval(myIntval);

                        }else if(trade_state.code="PAYERROR"){

                            document.getElementById("myDiv").innerHTML="支付失败";
                            clearInterval(myIntval);

                        }



                    }


                }

//    * xmlhttp.open(method, url, asynch);
//*         * 与服务器建立连接使用
//    *         * method：请求类型，类似 “GET”或”POST”的字符串。
//*         * url：路径字符串，指向你所请求的服务器上的那个文件。请求路径
//    *         * asynch：表示请求是否要异步传输，默认值为true(异步)。
//
                xmlhttp.open("POST","/payment/example/orderquery.php",false);
//如果是POST请求方式，设置请求首部信息
                xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
                /*
                 *
                 *     send()方法：
                 *         * 如果浏览器请求的类型为GET类型时，通过send()方法发送请求数据，服务器接收不到
                 *         * 如果浏览器请求的类型为POST类型时，通过send()方法发送请求数据，服务器可以接收
                 */
                xmlhttp.send("out_trade_no="+wx_trade_no);

                     }




        }






        }
    })







}











</script>
</body>
</html>