<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>华夏夫人-{dede:field.typename/}</title>
    <meta name="Keywords" content="">
    <meta name="Description" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <link rel="stylesheet" type="text/css" href="{dede:global.cfg_templets_skin/}/css/reset.css">
    <link rel="stylesheet" type="text/css" href="{dede:global.cfg_templets_skin/}/css/style.css">
    <link rel="stylesheet" type="text/css" href="{dede:global.cfg_templets_skin/}/css/mobile.css">
    <link href="{dede:global.cfg_templets_skin/}/css/video-js.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
    <!-- If you'd like to support IE8 -->
    <script src="{dede:global.cfg_templets_skin/}/js/videojs-ie8.min.js"></script>
    <style>
        #my-video{width: 100%;height:540px;background:url(/templets/default/img/1.jpg)0 0 no-repeat;background-size:cover;z-index: 1}
    </style></head>
  <body>
    <!--内页头部部分--><header class="top">
<div class="top_tel top_box">
  <div class="top_tel_top">
  <nav>
    <div class="top_tel_l">全国客服热线：<span>{dede:global.cfg_tel/}</span></div>
    <div class="top_tel_r">
    <ul id="quickMenu">
    {dede:php}
  //未登录显示的head

  require_once(DEDEINC."/memberlogin.class.php");
  $member = new MemberLogin();
  $memberID = $member->M_LoginID;

          //登录后显示的head
  if($memberID) {

          $a =   '<SPAN style="color:#fff;line-height: 28px">会员:</SPAN><a href="#" class="userName" style="color:#fff;line-height: 28px">'.$memberID.'</a>'.'   <a href="/member/index_do.php?fmdo=login&dopost=exit#" style="color:#fff;line-height: 28px">[退出]</a>';
          echo $a;
  }
  else {

          echo    '
          <li><a title="登录" rel="nofollow" href="/member/login.php">登录</a> </li>
          <li></li>
          <li><a title="注册" rel="nofollow" href="/member/index_do.php?fmdo=user&dopost=regnew">注册</a> </li>';
  }
  {/dede:php}
    </ul></div>
    </nav>
  </div>
  <div class="menu_nav">
     <section>
     <div class="pc_logo"><a href="/"><img src="/templets/default/img/logo.png" alt="华夏夫人官网"></a></div>
     <div class="nav"><ul>
     <li><a href="/"><span></span><em>华夏夫人首页</em></a></li> 
  <li><a href="/plus/list.php?tid=1"><span></span><em>华夏夫人资讯 </em></a></li>
  <li><a href="/plus/list.php?tid=2"><span></span><em>华夏夫人报名 </em></a></li>
  <li class="on"><a href="/plus/list.php?tid=3"><span></span><em>投票注册 </em></a></li>
  <li><a href="/plus/list.php?tid=4"><span></span><em>培训系统 </em></a></li>
  <li><a href="/plus/list.php?tid=5"><span></span><em>招商加盟 </em></a></li>
  <li><a href="/plus/list.php?tid=6"><span></span><em>家教传承 </em></a></li>
  <li><a href="/plus/list.php?tid=7"><span></span><em>关于我们 </em></a></li>
     </ul></div>
     </section>
  </div>
</div>
<section class="mobile_menu"><a class="back" onclick="history.go(-1)"></a><h1>魅力夫人</h1>
<div class="menu">
   <span id="menu"></span>
   <div class="menu_li">
   <div id="menu_left"></div>
    <ul>
     <li><a href="/"> 华夏夫人首页</a></li>

 <li><a href="/plus/list.php?tid=1"> 华夏夫人资讯 </a></li>

 <li><a href="/plus/list.php?tid=2"> 华夏夫人报名 </a></li>

 <li><a href="/plus/list.php?tid=3"> 投票注册 </a></li>

 <li><a href="/plus/list.php?tid=4"> 培训系统 </a></li>

 <li><a href="/plus/list.php?tid=5"> 招商加盟 </a></li>

 <li><a href="/plus/list.php?tid=6"> 家教传承 </a></li>

 <li><a href="/plus/list.php?tid=7"> 关于我们 </a></li>

<li><a title="注册" rel="nofollow"  href="/member/index_do.php?fmdo=user&dopost=regnew">注册</a> </li>
        <li><a title="登录" rel="nofollow" href="/member/login.php">登录</a> </li>
    </ul>
   </div>
</div>
</section>
</header>
<!--top is over-->
    <!--top is over-->
    <section class="peixun_content newxq_content">
      <span class="position">当前位置：<a href='/'>华夏夫人首页</a>><a href='/plus/list.php?tid=3'>投票注册</a>></span>
      <div class="toupiao">
        <h1>佳人简介</h1>
        <div class="tp_box mtp_box jrjj">
          <p>
            <img src="{dede:field.litpic/}" class="furen" alt="{dede:field.title/}">
            <img src="{dede:global.cfg_templets_skin/}/img/tpfr.png" class="furenbg" alt="华夏夫人框"></p>
        </div>
        <div class="fr_dec">
          <p>
            <span>姓名：{dede:field.csz/}</span>
            <span>民族：{dede:field.mz/}</span>
              报名编号：<span id='aid'>{dede:field.aid/}</span>
            <span>政治面貌：{dede:field.zzmm/}</span></p>
          <p id="caiyi">才艺：{dede:field.caiyi/}</p>
          <p>当前投票数：{dede:field.toupiao/}</p>
          <p>自我评价：{dede:field.zwpj/}</p>
          <button class="tou_box" style="cursor: pointer;" onclick='ajax_tp("{dede:field.aid/}")'>投票</button>
		  




            {dede:php}
          if($cfg_ml->IsLogin()){

            echo  '<a class="gift" style="cursor: pointer;">送礼</a>';

            }else{

            echo '<button class="tou_box" style="cursor: pointer;" onclick="islogin()">送礼</button>';

            }
            {/dede:php}



        </div>
        <div class="clear"></div>
      </div>
      <div class="video">
        <h1>佳人展示视频</h1>
        <div class="m">
          <video id="my-video" class="video-js" controls preload="auto" poster="" data-setup="{}">
            <source src="{dede:field.shipin/}" type="video/mp4">
              <source src="{dede:field.shipin/}" type="video/webm">
                <source src="{dede:field.shipin/}" type="video/ogv">
                  <p class="vjs-no-js">
                    <a href="http://videojs.com/html5-video-support/" target="_blank"></a>
                  </p>
          </video>
          <script src="http://vjs.zencdn.net/5.18.4/video.min.js"></script>
          <script type="text/javascript">var myPlayer = videojs('my-video');
            videojs("my-video").ready(function() {
              var myPlayer = this;
              myPlayer.play();
            });</script>
        </div>
      </div>
      <p class="frone">
        <a href="{dede:prenext get='next' runphp="yes"}preg_match_all('/<a.*?(?: |\\t|\\r|\\n)?href=[\'"]?(.+?)[\'"]?(?:(?: |\\t|\\r|\\n)+.*?)?>(.+?)<\/a.*?>/sim', @me, $strResult, PREG_PATTERN_ORDER);@me=$strResult[1][0];{/dede:prenext}" class="on ">上一位夫人</a>

        <a href="{dede:prenext get='pro' runphp="yes"}preg_match_all('/<a.*?(?: |\\t|\\r|\\n)?href=[\'"]?(.+?)[\'"]?(?:(?: |\\t|\\r|\\n)+.*?)?>(.+?)<\/a.*?>/sim', @me, $strResult, PREG_PATTERN_ORDER);@me=$strResult[1][0];{/dede:prenext} ">下一位夫人</a>
      </p>
    </section>
    <section class="infoot">
      <!--pc新增滚动入口-->{dede:include filename="gdrk.htm"/}</div></section>
    <a href="/a/new" class="jzmore jzmore2 mcss">查看更多</a>
    <div class="clear"></div>
    <div class="infoot_process">
      <ul>
        <li>
          <span></span>
          <em>选拔流程Process</em></li>
        <li>
          <span>1</span>
          <em>免费报名</em></li>
        <li>
          <span>2</span>
          <em>第一轮海选</em></li>
        <li>
          <span>3</span>
          <em>第二轮市选</em></li>
        <li>
          <span>4</span>
          <em>第三轮省选</em></li>
        <li>
          <span>5</span>
          <em>第四轮国选</em></li>
        <li>
          <span>6</span>
          <em>第五轮丝路巡</em></li>
      </ul>
    </div>
    </section>
    <section class="hid_box">
      <!-- <div class="show_box">
        <span class="close"></span>
        <p>抱歉，您还没有登录，登录后才能投票哦~
          <br/>赶快去登录吧！</p>
        <div class="show_btn">
          <a href="/member/login.php">去登录</a>
          <a href="/member/index_do.php?fmdo=user&dopost=regnew">去注册</a></div>
      </div> -->
    </section>
    <form  method="post" action="/alipay/pagepay/gift_pay.php" >
    <section class="hid_box2">

      <div class="show_box2">
        <h2>送礼</h2>
        <p>

        {dede:sql sql="select * from `dede_gift`"}

        <a  id="gift[field:id/]" class="gift2">
            <img src="/templets/default/img/gift[field:id/].png">
            <em>
                <span  id="g_name[field:id/]" >[field:name/]</span><br>
                <span class="bjprace[field:id/] bjprace"  >[field:price/]</span>元
                <span class="addps" id="g_number[field:id/]">[field:number_votes/]</span>票</em></a>
                <input type="hidden" name="s_id" id="s_id[field:id/]" value="[field:id/]">
        {/dede:sql}
        </p>
        <div class="clear"></div>
        <div class="count_jg">
          <div class="count_left">
            <span>数量</span>
            <input type="number" min="0" value='1' class="count" id="cont"   name="number"/></div>
          <div class="count_right">支付：￥
            <input  name="price" class="price"    id="price"     style="width: 70px;
                    display: inline-block;
                    border: none;
                    margin-left: 18px;
                    font-size: 24px;"  value="1" ></input>
          <input type="hidden"   id="c_name"  name="b_name" value="烈焰红唇">
          <input type="hidden"   id="univalent"  name="univalent" value="1">
          <input type="hidden"   id="gift_id"  name="gift_id"   value="11">
          <input type="hidden"   id="gift_vote" name="gift_vote"  value="1">
          <input type="hidden"   id="a_a_id" name="ali_aid" value="{dede:field.aid/}">
          </div>
        </div>
        <div class="clear"></div>
        <div class="show_btn2">
          <button  id="cpay"  type="button">支付</button>
          <button class="close2"  type="button">关闭</button></div>
      </div>
    </section>{dede:include filename="foot.htm"/}
   <section class="hid_box3">
  <div class="show_box3">   
      <div id="wu">
  <h2>选择支付方式</h2>
  <p><a id="weixin"><img src="/templets/default/img/weixin2.png" onclick="weixin_1()"><em>微信支付</em></a>
  <a id="gift2" class="zfb"><img src="/templets/default/img/zfb2.png" onclick="go_money_1()"><em>支付宝支付</em></a></p></div>
  <div id="none" style="display:none;width: 24%;margin: 37px auto;"><img src="../../images/wx/wechat.jpg" style="width:100%"></div>
   <div class="show_btn3"><div class="goods_btn">

   </div><button style="border-radius: 15px;display: inline-block;font-size: 24px;color: #fff;padding: 10px;width: 130px;text-align: center;background-color: #dedede;border: 2px solid #dedede;display:none;" class="zf" id="go_money" onclick="pay()" type="submit" >支付宝</button>
       <button style="border-radius: 15px;display: inline-block;font-size: 24px;color: #fff;padding: 10px;width: 130px;text-align: center;background-color: #dedede;border: 2px solid #dedede;display:none;" class="zf" id="go_weixin" type="button" onclick="wx_pay()">微信</button>
       <button style="border-radius: 15px;display: inline-block;font-size: 24px;color: #fff;padding: 10px;width: 130px;text-align: center;background-color: #dedede;border: 2px solid #dedede;" class="zf" id="select" onclick="select_s()" type="button">去支付</button>
       <a href="#" class="close3" onclick="over()" id="over" style="margin-left: 20px">关闭</a></div>
  </div>
</section>
    </form>
  <script type="text/javascript">
$(function(){
  $("#weixin").click(function(){
 $("#weixin img").attr("src","/templets/default/img/weixin.png");
 $(".zfb img").attr("src","/templets/default/img/zfb2.png");
});
  $(".zfb").click(function(){
 $(".zfb img").attr("src","/templets/default/img/zfb.png");
  $("#weixin img").attr("src","/templets/default/img/weixin2.png");
});
 $("#cpay").click(function(){
  $(".hid_box3").show();
 });
  })

</script>
<script   language="javascript">
    function pay(){

        var amount          = document.getElementById("cont").value;  //gift amount
        var price           = document.getElementById("price").value; //总价
        var gift_name       = document.getElementById("c_name").value;//gift name
        var univalent       = document.getElementById("univalent").value;//gift univalent
        var gift_id         = document.getElementById("gift_id").value;//gift id
        var a_id            = document.getElementById("a_a_id").value; //要获取aid
        var number_votes    = document.getElementById("gift_vote").value;//gift number votes


    }

    function  over(){

        $(".hid_box3").css("display","none");
         $(".return").css("display","none");

    }
    function go_money_1(){

        document.getElementById("go_money").style.display="inline-block";
        document.getElementById("go_weixin").style.display="none";
        document.getElementById("select").style.display="none";
    }

    function  zhifu(){
      document.getElementById("wu").style.display="none";
      document.getElementById("none").style.display="block";

    }

    function weixin_1(){

       document.getElementById("select").style.display="none";
       document.getElementById("go_weixin").style.display="inline-block";
       document.getElementById("go_money").style.display="none";

    }
function select_s(){

        alert('请选择支付方式');

/*
    $.ajax({
        type:'POST',
        url:"/ss.php",
        data:{user:1},
        dataType: "json",
        success:function (ss) {

            alert(ss.message);
            console.log(ss.message);
    }});
*/


}

</script>
    <script type="text/javascript" src="{dede:global.cfg_templets_skin/}/js/box.js"></script>
    <script src="{dede:global.cfg_templets_skin/}/js/menu.js"></script>
    <script src="{dede:global.cfg_templets_skin/}/js/lk.js"></script>
    <script src="{dede:global.cfg_templets_skin/}/js/gift.js"></script>
    <script src="/layer/jquery.js"></script>
   <script src="/layer/layer.js"></script>
  </body>

  <script>
      function  ajax_tp(tp){

          var a =$('.userName').text();


          if(a==''){
              $(".hid_box").append("<div class='show_box'><span class='close' onclick='hideK()'></span><p>抱歉，您还没有登录，登录后才能投票哦~<br/>赶快去登录吧！</p><div class='show_btn'><a href='/member/login.php'>去登录</a><a href='/member/index_do.php?fmdo=user&dopost=regnew'>去注册</a></div></div>")
          }else{
              $.ajax({
                  type:'POST',
                  dataType:'json',
                  url:'../../plus/tp.php',
                  data:{'id':tp,
                      'uname':a},
                  success:function(id){

                      if(id.message==1){
                          hideK();
                          alert(id.status);
                          // window.location.reload();
                      }else{
                          hideK();
                          alert(id.status);
                      }
                  }
              });
          }
      }
      function hideK(){
          $('.hid_box').css('display','none');
      }

      function islogin(){

          $(".hid_box").append("<div class='show_box'><span class='close' onclick='hideK()'></span><p>抱歉，您还没有登录，登录后才能投票哦~<br/>赶快去登录吧！</p><div class='show_btn'><a href='/member/login.php'>去登录</a><a href='/member/index_do.php?fmdo=user&dopost=regnew'>去注册</a></div></div>");



      }

      function hideK(){
          $('.hid_box').css('display','none');
      }


      //the following is related to the payment

      function  wx_pay(){
       var  amount          = document.getElementById("cont").value;  //gift amount
       var  price           = document.getElementById("price").value; //总价
       var  gift_name       = document.getElementById("c_name").value;//gift name
       var univalent        = document.getElementById("univalent").value;//gift univalent
       var gift_id          = document.getElementById("gift_id").value;//gift id
       var a_id             = document.getElementById("aid").innerText; //要获取aid
       var number_votes     = document.getElementById("gift_vote").value;//gift number votes

   var  xmlhttp;

     if(window.XMLHttpRequest){ //如果不是ie浏览器

         xmlhttp = new XMLHttpRequest();

     }else if(window.ActiveXObject){

     xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");  //如果是ie浏览器

     }


          ////    readyState 属性表示Ajax请求的当前状态。它的值用数字代表。
////                0 代表未初始化。 还没有调用 open 方法
////    1 代表正在加载。 open 方法已被调用，但 send 方法还没有被调用
////    2 代表已加载完毕。send 已被调用。请求已经开始
////    3 代表交互中。服务器正在发送响应
////    4 代表完成。响应发送完毕
//
////    常用状态码及其含义：
////                404 没找到页面(not found)
////    403 禁止访问(forbidden)
////    500 内部服务器出错(internal service error)
////    200 一切正常(ok)
////    304 没有被修改(not modified)(服务器返回304状态，表示源文件没有被修改 )

    xmlhttp.onreadystatechange=function(){

         if(xmlhttp.readyState == 4 && xmlhttp.status == 200){

             dream  = JSON.parse(xmlhttp.responseText); //吧返回来的json数据转换下

             if(dream.message == 1 ){
               var code = dream.code;
               var x_trade_to = dream.out_trade_no;
                 layer.open({

                     skin:'layui-layer-rim',//样式类名，随意！
                     closeBtin:0,//不显示关闭按钮
                     title:false,//关闭title部分
                     anim:2,
                     area:['300px','450px'],//呈的宽高
                     shadeClose:true,
                     content:'<div style="color: #666;margin: 5px 0 0 10px;position: absolute;right:.5rem;" onclick="layer.closeAll()">X</div>'+'<div style="text-align: center;"><img style="width: 4rem;padding:2rem 0 1rem 0;" src="/templets/default/img/weixin.png" alt="" /><br><b style="font-weight: 100;color: #888;">请打开微信 扫码进行支付 </b><div class="blank"></div>支付金额：<span style="color: red;">'+price+'</span> 元</div><div class="blank"></div>'+'<div style="text-align: center"><img src="'+"http://paysdk.weixin.qq.com/example/qrcode.php?data="+code+'" class="resize" style="width:70%;"></div><div id="myDiv" style="width: 100%;height: 1.5rem;bottom: 2rem;position:absolute;text-align:center;font-size: 1.2rem;color: red;"></div><div id="timer" style="display:none;">0</div>'
                 });


             var myIntval  =setInterval(function(){load()},1000); //定个函数 1000毫秒 1次

               function  load(){

                   var xiaohttp;

                   if(window.XMLHttpRequest){
                       //如果不是ie浏览器
                       xiaohttp = new XMLHttpRequest();

                   }else if(window.ActiveXObject){
                       //如果是ie浏览器
                       xiaohttp = new ActiveXObject("Microsoft.XMLHTTP");

                   }


                   xiaohttp.onreadystatechange=function(){

                       if(xiaohttp.readyState==4 && xiaohttp.status==200){

                           trade_to =JSON.parse(xiaohttp.responseText);

                           if(trade_to.code=="NOTPAY"){

                               document.getElementById("myDiv").innerHTML="请扫码支付";

                           }else if(trade_to.code=="SUCCESS"){

                               document.getElementById("myDiv").innerHTML="支付成功";
                               clearInterval(myIntval);
                               setTimeout(function(){  //使用  setTimeout（）方法设定定时2000毫秒
                                   window.location.reload();//页面刷新
                               },3000);

                           }else if(trade_state.code="CLOSED"){

                               document.getElementById("myDiv").innerHTML="交易已关闭";
                               clearInterval(myIntval);
                           }else if(trade_state.code="REVOKED"){

                               document.getElementById("myDiv").innerHTML="已撤销";
                               clearInterval(myIntval);

                           }else if(trade_state.code="REFUND"){

                               document.getElementById("myDiv").innerHTML="转入退款";
                               clearInterval(myIntval);

                           }else if(trade_state.code="USERPAYING"){

                               document.getElementById("myDiv").innerHTML="用户支付中";
                               clearInterval(myIntval);

                           }else if(trade_state.code="PAYERROR"){

                               document.getElementById("myDiv").innerHTML="支付失败";
                               clearInterval(myIntval);

                           }



                       }




                   }


                   xiaohttp.open("POST","/payment/example/orderquery.php",true);
                   xiaohttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
                   xiaohttp.send("out_trade_no="+x_trade_to);


               }






             }





         }

    }

//    * xmlhttp.open(method, url, asynch);
//*         * 与服务器建立连接使用
//    *         * method：请求类型，类似 “GET”或”POST”的字符串。
//*         * url：路径字符串，指向你所请求的服务器上的那个文件。请求路径
//    *         * asynch：表示请求是否要异步传输，默认值为true(异步)。
        xmlhttp.open("POST","/payment/example/gift_native.php",true);
////如果是POST请求方式，设置请求首部信息
       xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
//           *     send()方法：
//           *         * 如果浏览器请求的类型为GET类型时，通过send()方法发送请求数据，服务器接收不到
//           *         * 如果浏览器请求的类型为POST类型时，通过send()方法发送请求数据，服务器可以接收


          xmlhttp.send("amount="+amount+"&price="+price+"&gift_name="+gift_name+"&univalent="+univalent+"&gift_id="+gift_id+"&a_id="+a_id+"&number_votes="+number_votes);

         }





  </script>




</html>